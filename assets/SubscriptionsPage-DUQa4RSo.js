import{r as n,u as N,j as c,B as v}from"./index-DVXXM6oO.js";import{V as C}from"./VideoCard-LOU0JywA.js";import{l as B}from"./videoDataLoader-BZaTkg2Q.js";import{d as M}from"./data_fetch-aBz1sAwe.js";import{S as D}from"./formatters-DnYoOpiC.js";import{H}from"./heading-C5MqQ-9T.js";import{S as R}from"./simple-grid-DPQHptrj.js";import"./skeleton-BkAdXBqt.js";function q(){const[w,V]=n.useState(!0),[i,g]=n.useState(!1),[a,f]=n.useState([]),[p,l]=n.useState([]),[d,x]=n.useState([]),[E,y]=n.useState(1),h=n.useRef(null),A=N(),u=10;n.useEffect(()=>{(async()=>{try{const t=await M("/data/subscriptions.json");x(t||[])}catch(t){console.error("Error fetching subscriptions:",t),x([])}})()},[]),n.useEffect(()=>{const e=async()=>{try{const t=await B();if(t&&Array.isArray(t)){const s=t.map((r,m)=>{const k=m%d.length,b=d[k];return{...r,channelName:b?.name||r.channelName,channelAvatar:b?.avatar||r.channelAvatar}});f(s);const o=s.slice(0,u);l(o)}else console.error("Invalid data format received"),f([]),l([])}catch(t){console.error("Error fetching video data:",t),f([]),l([])}finally{V(!1)}};d.length>0&&e()},[d]);const I=()=>{i||a.length===0||(g(!0),setTimeout(()=>{const e=E*u;let t=e+u;if(e>=a.length){t=u;const o=a.slice(0,t);l(r=>[...r,...o])}else if(t>a.length){const s=a.slice(e),o=a.slice(0,t-a.length),r=[...s,...o];l(m=>[...m,...r])}else{const s=a.slice(e,t);l(o=>[...o,...s])}y(s=>s+1),g(!1)},1e3))},S=()=>{if(!h.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:s}=h.current;(e+s)/t>.8&&!i&&p.length>0&&I()};n.useEffect(()=>{const e=h.current;if(e)return e.addEventListener("scroll",S),()=>e.removeEventListener("scroll",S)},[i,p.length]);const L=e=>{A(`/watch/${e}`)},j=e=>{console.log(`Clicked on channel: ${e}`)},P=e=>{console.log(`More options for video: ${e}`)};return c.jsxs(v,{ref:h,className:"custom-scrollbar",overflowY:"auto",h:"full",w:"full",p:"20px",children:[c.jsx(H,{as:"h1",size:"2xl",color:"white",mb:"24px",fontSize:{base:"24px",md:"28px",lg:"36px"},fontWeight:"600",children:"Latest"}),c.jsxs(R,{columns:{base:1,sm:1,md:2,lg:3,xl:4},spacing:"20px",gap:4,w:"full",children:[w?Array.from({length:10},(e,t)=>c.jsx(C,{isLoading:!0},`loading-${t}`)):p.map(e=>c.jsx(C,{thumbnail:e.thumbnail,title:e.title,channelName:e.channelName,channelAvatar:e.channelAvatar,views:e.views,uploadDate:e.uploadDate,duration:e.duration,isVerified:e.isVerified,onVideoClick:()=>L(e.id),onChannelClick:()=>j(e.channelName),onMoreClick:()=>P(e.id)},e.id)),i&&c.jsx(D,{gridColumn:"1 / -1",text:"Loading more videos...",textColor:"gray.600"})]})]})}export{q as default};
